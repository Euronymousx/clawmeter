<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClawMeter - OpenClaw Cost Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f23;
            color: #fff;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        header {
            text-align: center;
            padding: 2rem 0;
        }
        
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        
        .tagline {
            color: #888;
            font-size: 1.1rem;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .metric-card {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #2d2d44;
        }
        
        .metric-card h3 {
            color: #888;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #fff;
        }
        
        .metric-value.cost {
            color: #10b981;
        }
        
        .metric-value.warning {
            color: #f59e0b;
        }
        
        .metric-value.danger {
            color: #ef4444;
        }
        
        .add-entry-form {
            background: #1a1a2e;
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid #2d2d44;
        }
        
        .add-entry-form h2 {
            margin-bottom: 1.5rem;
            color: #fff;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .form-group input,
        .form-group select {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid #2d2d44;
            background: #0f0f23;
            color: #fff;
            font-size: 1rem;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            padding: 0.75rem 2rem;
            border-radius: 8px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button.secondary {
            background: #2d2d44;
            margin-left: 0.5rem;
        }
        
        .entries-section {
            background: #1a1a2e;
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid #2d2d44;
        }
        
        .entries-section h2 {
            margin-bottom: 1rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        th, td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid #2d2d44;
        }
        
        th {
            color: #888;
            font-weight: 500;
        }
        
        .delete-btn {
            background: #ef4444;
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
        }
        
        .pricing-table {
            background: #1a1a2e;
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid #2d2d44;
        }
        
        .pricing-table h2 {
            margin-bottom: 1rem;
        }
        
        footer {
            text-align: center;
            padding: 2rem 0;
            color: #666;
        }
        
        .budget-form {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .budget-form input {
            width: 100px;
            padding: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>âš¡ ClawMeter</h1>
            <p class="tagline">Track your OpenClaw API costs manually</p>
        </header>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <h3>Today's Cost</h3>
                <div class="metric-value cost" id="todayCost">$0.00</div>
            </div>
            <div class="metric-card">
                <h3>This Week</h3>
                <div class="metric-value" id="weekCost">$0.00</div>
            </div>
            <div class="metric-card">
                <h3>This Month</h3>
                <div class="metric-value" id="monthCost">$0.00</div>
            </div>
            <div class="metric-card">
                <h3>Budget Remaining</h3>
                <div class="metric-value" id="remainingBudget">$100.00</div>
            </div>
        </div>
        
        <div class="add-entry-form">
            <h2>âž• Add Usage Entry</h2>
            <form id="entryForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="model">Model</label>
                        <select id="model" required>
                            <option value="kimi-k2">Kimi K2.5</option>
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="gpt-4o-mini">GPT-4o Mini</option>
                            <option value="claude-3-5-sonnet">Claude 3.5 Sonnet</option>
                            <option value="claude-3-opus">Claude 3 Opus</option>
                            <option value="claude-3-haiku">Claude 3 Haiku</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inputTokens">Input Tokens</label>
                        <input type="number" id="inputTokens" placeholder="e.g., 1000" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="outputTokens">Output Tokens</label>
                        <input type="number" id="outputTokens" placeholder="e.g., 500" min="0" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="description">Description (optional)</label>
                        <input type="text" id="description" placeholder="What did you use it for?">
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button type="submit">Add Entry</button>
                    </div>
                </div>
            </form>
        </div>
        
        <div class="entries-section">
            <h2>ðŸ“Š Recent Entries</h2>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Model</th>
                        <th>Input</th>
                        <th>Output</th>
                        <th>Cost</th>
                        <th>Description</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="entriesTable">
                </tbody>
            </table>
        </div>
        
        <div class="pricing-table">
            <h2>ðŸ’° Model Pricing (per 1K tokens)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Input</th>
                        <th>Output</th>
                    </tr>
                </thead>
                <tbody id="pricingTable">
                </tbody>
            </table>
        </div>
        
        <footer>
            <p>Built for the OpenClaw community â€¢ Track your AI costs</p>
        </footer>
    </div>
    
    <script>
        async function fetchCosts() {
            try {
                const response = await fetch('/api/costs');
                const data = await response.json();
                
                document.getElementById('todayCost').textContent = '$' + data.today.cost.toFixed(4);
                document.getElementById('weekCost').textContent = '$' + data.this_week.cost.toFixed(4);
                document.getElementById('monthCost').textContent = '$' + data.this_month.cost.toFixed(4);
                
                const remainingEl = document.getElementById('remainingBudget');
                remainingEl.textContent = '$' + data.remaining.toFixed(2);
                
                // Color code remaining budget
                remainingEl.className = 'metric-value';
                if (data.remaining < 0) {
                    remainingEl.classList.add('danger');
                } else if (data.remaining < data.budget * 0.2) {
                    remainingEl.classList.add('warning');
                } else {
                    remainingEl.classList.add('cost');
                }
                
                // Populate pricing table
                const tbody = document.getElementById('pricingTable');
                tbody.innerHTML = '';
                for (const [key, model] of Object.entries(data.models)) {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${model.name}</td>
                        <td>$${model.input.toFixed(4)}</td>
                        <td>$${model.output.toFixed(4)}</td>
                    `;
                }
            } catch (error) {
                console.error('Error fetching costs:', error);
            }
        }
        
        async function fetchEntries() {
            try {
                const response = await fetch('/api/entries');
                const data = await response.json();
                
                const tbody = document.getElementById('entriesTable');
                tbody.innerHTML = '';
                
                for (const entry of data.entries) {
                    const row = tbody.insertRow();
                    const date = new Date(entry.date).toLocaleDateString();
                    row.innerHTML = `
                        <td>${date}</td>
                        <td>${entry.model}</td>
                        <td>${entry.input_tokens?.toLocaleString() || 0}</td>
                        <td>${entry.output_tokens?.toLocaleString() || 0}</td>
                        <td>$${entry.cost?.toFixed(4) || '0.0000'}</td>
                        <td>${entry.description || '-'}</td>
                        <td><button class="delete-btn" onclick="deleteEntry(${entry.id})">Delete</button></td>
                    `;
                }
            } catch (error) {
                console.error('Error fetching entries:', error);
            }
        }
        
        document.getElementById('entryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const entry = {
                model: document.getElementById('model').value,
                input_tokens: parseInt(document.getElementById('inputTokens').value) || 0,
                output_tokens: parseInt(document.getElementById('outputTokens').value) || 0,
                description: document.getElementById('description').value
            };
            
            try {
                await fetch('/api/entries', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(entry)
                });
                
                // Clear form
                document.getElementById('inputTokens').value = '';
                document.getElementById('outputTokens').value = '';
                document.getElementById('description').value = '';
                
                // Refresh data
                fetchCosts();
                fetchEntries();
            } catch (error) {
                console.error('Error adding entry:', error);
            }
        });
        
        async function deleteEntry(id) {
            if (!confirm('Delete this entry?')) return;
            
            try {
                await fetch(`/api/entry/${id}`, {method: 'DELETE'});
                fetchCosts();
                fetchEntries();
            } catch (error) {
                console.error('Error deleting entry:', error);
            }
        }
        
        // Load data on page load
        fetchCosts();
        fetchEntries();
        
        // Refresh every 30 seconds
        setInterval(() => {
            fetchCosts();
            fetchEntries();
        }, 30000);
    </script>
</body>
</html>
